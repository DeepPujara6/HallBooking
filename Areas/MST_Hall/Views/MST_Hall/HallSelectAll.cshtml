@using System.Data;
@model DataTable;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";

}
@{
    var successMessage = TempData["successMessage"]?.ToString();
    var errorMessage = TempData["errorMessage"]?.ToString();
}

@if (!string.IsNullOrWhiteSpace(successMessage))
{
    <div class="alert alert-success alert-dismissible" role="alert">
        @successMessage

        <button type="button" class="btn-close float-end" aria-label="Close" data-bs-dismiss="alert">X</button>
    </div>
}
else if (!string.IsNullOrWhiteSpace(errorMessage))
{
    <div class="alert alert-danger alert-dismissible" role="alert">
        @errorMessage

        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">X</button>
    </div>
}


<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Hall List</h6>
    </div>
    <br />
    <div class="datatable-top">
        <form class="form-inline mb-2 mb-sm-0" asp-action="HallSearch" asp-area="MST_Hall" asp-controller="MST_Hall" style="margin-left: 10px;">
            <input class="form-control mr-2 mb-2 mb-sm-0" type="search" placeholder="Hall Name" name="HallName" aria-label="Search">

            <input class="form-control mr-2 mb-2 mb-sm-0" type="number" pattern="\d*" placeholder="Hall Capacity" name="HallCapacity" aria-label="Search">

            <!-- Single Search Button -->
            <button type="submit" class="btn btn-outline-primary">Search</button>
        </form>

        <br />
    </div>
    <div class="row">

        <div class="col-md-8">
            
            <a class="btn btn-success" asp-area="MST_Hall" asp-controller="MST_Hall" asp-action="WritedatatoExcel">Export to Excel</a>
            <button id="deleteSelected" class="btn btn-danger" asp-area="MST_Hall" asp-controller="MST_Hall" asp-action="deletemultiple">Delete Selected</button>
        </div>
        <div class="col-md-4 text-right pr-3">
            <a type="button" class="btn btn-primary" asp-action="HallAddEdit" asp-controller="MST_Hall" asp-area="MST_Hall">
                <i class="fa fa-plus"></i> Add New
            </a>     
        </div>
    </div>


<div class="card-body">
    <div class="table-responsive">
        <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">
                <div class="col-sm-12">
                    <table class="table table-bordered dataTable" id="dataTable" width="100%" cellspacing="0" role="grid" aria-describedby="dataTable_info" style="width: 100%;">
                       
                        <thead>
                            <!-- Custom styles for this page -->
                            
                            <tr>
                                
                                <th rowspan="1" colspan="1">Delete</th>
                                <th rowspan="1" colspan="1">Actions</th>    
                                <th rowspan="1" colspan="1">Hall Name</th>     
                                <th rowspan="1" colspan="1">Hall Description</th>
                                <th rowspan="1" colspan="1">Capacity</th>
                                <th rowspan="1" colspan="1">PricePerDay</th>
                                <th rowspan="1" colspan="1">Deposit</th>
                                <th rowspan="1" colspan="1">LocationURL</th>
                                <th rowspan="1" colspan="1">ImageURL</th>
                                <th rowspan="1" colspan="1">FloorNo</th>
                                <th rowspan="1" colspan="1">Address</th>
                                <th rowspan="1" colspan="1">ContactPerson</th>
                                <th rowspan="1" colspan="1">ContactNumber</th>
                                <th rowspan="1" colspan="1">MunicipalCorporation</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            @foreach(DataRow dr in Model.Rows){
                            <tr>

                            <td>
                                        <div class="form-check">
                                            <input type="checkbox" class="delete-checkbox" data-id="@dr["HallID"]" />
                                        </div>
                            </td>
                            <td>
                                <a href="@Url.Action("Add", "MST_Hall", new { HallID = @dr["HallID"] })" class="btn btn-primary btn-circle btn-sm">
                                    <i class="fas fa-edit"></i>
                                </a>
                                        <a href="@Url.Action("Delete", "MST_Hall", new { id = @dr["HallID"] })" class="btn btn-danger btn-circle btn-sm" data-confirm="Are you sure you want to delete this Hall?">
                                    <i class="fas fa-trash"></i>
                                </a> 
                                       
                            </td>
                            <td>
                                @dr["HallName"]
                            </td>
                            <td>
                                @dr["HallDescription"]
                            </td>
                            <td>
                                @dr["Capacity"]
                            </td>
                            <td>
                                @dr["PricePerDay"]
                            </td>
                            <td>
                                @dr["Deposit"]
                            </td>
                            <td>
                                @dr["LocationURL"]
                            </td>

                            <td>
                                <div class="avatar avatar-online">
                                    <img src="@dr["ImageURL"]" alt="Profile" class="w-px-40 h-auto rounded-circle" style="width: 150px; height: auto;" />
                                </div>
                            </td>
                            <td>
                                @dr["FloorNo"]
                            </td>
                            <td>
                                @dr["Address"]
                            </td>

                            <td>
                                @dr["ContactPerson"]
                            </td>
                            <td>
                                @dr["ContactNumber"]
                            </td>
                                    <td>
                                        @dr["MCName"]
                                    </td>
                            
                            </tr>

                        }
                        </tbody>
                    </table>
                </div>
            </div>
            @* <div class="row"><div class="col-sm-12 col-md-5"><div class="dataTables_info" id="dataTable_info" role="status" aria-live="polite">Showing 1 to 10 of 57 entries</div></div><div class="col-sm-12 col-md-7"><div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate"><ul class="pagination"><li class="paginate_button page-item previous disabled" id="dataTable_previous"><a href="#" aria-controls="dataTable" data-dt-idx="0" tabindex="0" class="page-link">Previous</a></li><li class="paginate_button page-item active"><a href="#" aria-controls="dataTable" data-dt-idx="1" tabindex="0" class="page-link">1</a></li><li class="paginate_button page-item "><a href="#" aria-controls="dataTable" data-dt-idx="2" tabindex="0" class="page-link">2</a></li><li class="paginate_button page-item "><a href="#" aria-controls="dataTable" data-dt-idx="3" tabindex="0" class="page-link">3</a></li><li class="paginate_button page-item "><a href="#" aria-controls="dataTable" data-dt-idx="4" tabindex="0" class="page-link">4</a></li><li class="paginate_button page-item "><a href="#" aria-controls="dataTable" data-dt-idx="5" tabindex="0" class="page-link">5</a></li><li class="paginate_button page-item "><a href="#" aria-controls="dataTable" data-dt-idx="6" tabindex="0" class="page-link">6</a></li><li class="paginate_button page-item next" id="dataTable_next"><a href="#" aria-controls="dataTable" data-dt-idx="7" tabindex="0" class="page-link">Next</a></li></ul></div></div></div> *@
        </div>
    </div>
    </div>





@section Scripts {
    <script>
        
        document.addEventListener("DOMContentLoaded", function () {
            // Add click event listener to "Delete Selected" button
            var deleteSelectedButton = document.getElementById("deleteSelected");
            deleteSelectedButton.addEventListener("click", function () {
                // Get all selected checkboxes
                var selectedCheckboxes = document.querySelectorAll(".delete-checkbox:checked");
                var selectedIds = Array.from(selectedCheckboxes).map(function (checkbox) {
                    return checkbox.getAttribute("data-id");
                });

                if (selectedIds.length === 0) {
                    // Show an alert if no checkboxes are selected
                    Swal.fire('No items selected!', 'Please select items to delete.', 'warning');
                    return;
                }

                // Show SweetAlert confirmation dialog
                Swal.fire({
                    title: 'Are you sure?',
                    text: 'You won\'t be able to revert this!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete selected items!'
                }).then(function (result) {
                    if (result.isConfirmed) {
                        // If user confirms, send a fetch request to delete action for selected items
                        var url = 'deletemultiple?ids=' + selectedIds.join(',');
                        fetch(url, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                        })
                            .then(response => {
                                if (response.ok) {
                                    // Optionally handle success response
                                    Swal.fire('Deleted!', 'The selected items have been deleted.', 'success');
                                    // Reload the page after successful deletion
                                    window.location.reload();
                                } else {
                                    // Optionally handle error response
                                    Swal.fire('Error!', 'Failed to delete the selected items.', 'error');
                                }
                            })
                            .catch(error => {
                                // Handle fetch error
                                console.error('Fetch error:', error);
                                Swal.fire('Error!', 'Failed to delete the selected items.', 'error');
                            });
                    }
                });
            });

            // Add click event listener to all delete buttons
            var deleteButtons = document.querySelectorAll(".delete-btn");

            deleteButtons.forEach(function (button) {
                button.addEventListener("click", function (event) {
                    event.preventDefault();

                    // Extract user ID from data attribute
                    var userId = button.getAttribute("data-id");
                    var url = 'Delete?Areas=MST_Admin&id=' + userId;

                    // Show SweetAlert confirmation dialog
                    Swal.fire({
                        title: 'Are you sure?',
                        text: 'You won\'t be able to revert this!',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Yes, delete it!'
                    }).then(function (result) {
                        if (result.isConfirmed) {
                            // If user confirms, send a fetch request to delete action
                            fetch(url, {
                                method: 'DELETE', // Use 'DELETE' if your server supports it
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                            })
                                .then(response => {
                                    if (response.ok) {
                                        // Optionally handle success response
                                        Swal.fire('Deleted!', 'The user has been deleted.', 'success');
                                        // Reload the page after successful deletion
                                        window.location.reload();
                                    } else {
                                        // Optionally handle error response
                                        Swal.fire('Error!', 'Failed to delete the user.', 'error');
                                    }
                                })
                                .catch(error => {
                                    // Handle fetch error
                                    console.error('Fetch error:', error);
                                    Swal.fire('Error!', 'Failed to delete the user.', 'error');
                                });
                        }
                    });
                });
            });
        });


        document.addEventListener('DOMContentLoaded', function () {
            const deleteButtons = document.querySelectorAll('[data-confirm]');

            deleteButtons.forEach(button => {
                button.addEventListener('click', function (e) {
                    e.preventDefault(); // Prevent the default behavior of the link

                    const confirmationMessage = this.getAttribute('data-confirm');
                    Swal.fire({
                        title: 'Are you sure?',
                        text: confirmationMessage,
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Yes, delete it!'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // If the user confirms, proceed with the deletion
                            window.location.href = this.getAttribute('href');
                        }
                    });
                });
            });
        });
    </script>
}



            





